/*
 * Poshy Tip jQuery plugin v1.2+
 * http://vadikom.com/tools/poshy-tip-jquery-plugin-for-stylish-tooltips/
 * Copyright 2010-2013, Vasil Dinkov, http://vadikom.com/
 */

(function($){var g=[],reBgImage=/^url\(["']?([^"'\)]*)["']?\);?$/i,rePNG=/\.png$/i,ie6=!!window.createPopup&&document.documentElement.currentStyle.minWidth=='undefined';function handleWindowResize(){$.each(g,function(){this.refresh(true)})}$(window).resize(handleWindowResize);$.Poshytip=function(a,b){this.$elm=$(a);this.opts=$.extend({},$.fn.poshytip.defaults,b);this.$tip=$(['<div class="infobox ',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>','</div>'].join('')).appendTo(document.body);this.$arrow=this.$tip.find('div.tip-arrow');this.$inner=this.$tip.find('div.tip-inner');this.disabled=false;this.content=null;this.init()};$.Poshytip.prototype={init:function(){g.push(this);var a=this.$elm.attr('title');this.$elm.data('title.poshytip',a!==undefined?a:null).data('poshytip',this);if(this.opts.showOn!='none'){this.$elm.bind({'mouseenter.poshytip':$.proxy(this.mouseenter,this),'mouseleave.poshytip':$.proxy(this.mouseleave,this)});switch(this.opts.showOn){case'hover':if(this.opts.alignTo=='cursor')this.$elm.bind('mousemove.poshytip',$.proxy(this.mousemove,this));if(this.opts.allowTipHover)this.$tip.hover($.proxy(this.clearTimeouts,this),$.proxy(this.mouseleave,this));break;case'focus':this.$elm.bind({'focus.poshytip':$.proxy(this.showDelayed,this),'blur.poshytip':$.proxy(this.hideDelayed,this)});break}}},mouseenter:function(e){if(this.disabled)return true;this.$elm.attr('title','');if(this.opts.showOn=='focus')return true;this.showDelayed()},mouseleave:function(e){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===e.relatedTarget||jQuery.contains(this.$tip[0],e.relatedTarget)))return true;if(!this.$tip.data('active')){var a=this.$elm.data('title.poshytip');if(a!==null)this.$elm.attr('title',a)}if(this.opts.showOn=='focus')return true;this.hideDelayed()},mousemove:function(e){if(this.disabled)return true;this.eventX=e.pageX;this.eventY=e.pageY;if(this.opts.followCursor&&this.$tip.data('active')){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow)this.$arrow[0].className='tip-arrow tip-arrow-'+this.pos.arrow}},show:function(){if(this.disabled||this.$tip.data('active'))return;this.reset();this.update();if(!this.content)return;this.display();if(this.opts.timeOnScreen)this.hideDelayed(this.opts.timeOnScreen)},showDelayed:function(a){this.clearTimeouts();this.showTimeout=setTimeout($.proxy(this.show,this),typeof a=='number'?a:this.opts.showTimeout)},hide:function(){if(this.disabled||!this.$tip.data('active'))return;this.display(true)},hideDelayed:function(a){this.clearTimeouts();this.hideTimeout=setTimeout($.proxy(this.hide,this),typeof a=='number'?a:this.opts.hideTimeout)},reset:function(){this.$tip.queue([]).detach().css('visibility','hidden').data('active',false);this.$inner.find('*').poshytip('hide');if(this.opts.fade)this.$tip.css('opacity',this.opacity);this.$arrow[0].className='tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left';this.asyncAnimating=false},update:function(b,c){if(this.disabled)return;var d=b!==undefined;if(d){if(!c)this.opts.content=b;if(!this.$tip.data('active'))return}else{b=this.opts.content}var e=this,newContent=typeof b=='function'?b.call(this.$elm[0],function(a){e.update(a)}):b=='[title]'?this.$elm.data('title.poshytip'):b;if(this.content!==newContent){this.$inner.empty().append(newContent);this.content=newContent}this.refresh(d)},refresh:function(a){if(this.disabled)return;if(a){if(!this.$tip.data('active'))return;var b={left:this.$tip.css('left'),top:this.$tip.css('top')}}this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined)this.opacity=this.$tip.css('opacity');this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(this.pos.arrow){this.$arrow[0].className='tip-arrow tip-arrow-'+this.pos.arrow;this.$arrow.css('visibility','inherit')}if(a&&this.opts.refreshAniDuration){this.asyncAnimating=true;var c=this;this.$tip.css(b).animate({left:this.pos.l,top:this.pos.t},this.opts.refreshAniDuration,function(){c.asyncAnimating=false})}else{this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(a){var b=this.$tip.data('active');if(b&&!a||!b&&a)return;this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(a&&this.opts.hideAniDuration||!a&&this.opts.showAniDuration)){var c={},to={};if(this.opts.slide&&this.pos.arrow){var d,arr;if(this.pos.arrow=='bottom'||this.pos.arrow=='top'){d='top';arr='bottom'}else{d='left';arr='right'}var e=parseInt(this.$tip.css(d));c[d]=e+(a?0:(this.pos.arrow==arr?-this.opts.slideOffset:this.opts.slideOffset));to[d]=e+(a?(this.pos.arrow==arr?this.opts.slideOffset:-this.opts.slideOffset):0)+'px'}if(this.opts.fade){c.opacity=a?this.$tip.css('opacity'):0;to.opacity=a?0:this.opacity}this.$tip.css(c).animate(to,this.opts[a?'hideAniDuration':'showAniDuration'])}a?this.$tip.queue($.proxy(this.reset,this)):this.$tip.css('visibility','inherit');if(b){var f=this.$elm.data('title.poshytip');if(f!==null)this.$elm.attr('title',f)}this.$tip.data('active',!b)},disable:function(){this.reset();this.disabled=true},enable:function(){this.disabled=false},destroy:function(){this.reset();this.$tip.remove();delete this.$tip;this.content=null;this.$elm.unbind('.poshytip').removeData('title.poshytip').removeData('poshytip');g.splice($.inArray(this,g),1)},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0}},calcPos:function(){var a={l:0,t:0,arrow:''},$win=$(window),win={l:$win.scrollLeft(),t:$win.scrollTop(),w:$win.width(),h:$win.height()},xL,xC,xR,yT,yC,yB;if(this.opts.alignTo=='cursor'){xL=xC=xR=this.eventX;yT=yC=yB=this.eventY}else{var b=this.$elm.offset(),elm={l:b.left,t:b.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};xL=elm.l+(this.opts.alignX!='inner-right'?0:elm.w);xC=xL+Math.floor(elm.w/2);xR=xL+(this.opts.alignX!='inner-left'?elm.w:0);yT=elm.t+(this.opts.alignY!='inner-bottom'?0:elm.h);yC=yT+Math.floor(elm.h/2);yB=yT+(this.opts.alignY!='inner-top'?elm.h:0)}switch(this.opts.alignX){case'right':case'inner-left':a.l=xR+this.opts.offsetX;if(this.opts.keepInViewport&&a.l+this.tipOuterW>win.l+win.w)a.l=win.l+win.w-this.tipOuterW;if(this.opts.alignX=='right'||this.opts.alignY=='center')a.arrow='left';break;case'center':a.l=xC-Math.floor(this.tipOuterW/2);if(this.opts.keepInViewport){if(a.l+this.tipOuterW>win.l+win.w)a.l=win.l+win.w-this.tipOuterW;else if(a.l<win.l)a.l=win.l}break;default:a.l=xL-this.tipOuterW-this.opts.offsetX;if(this.opts.keepInViewport&&a.l<win.l)a.l=win.l;if(this.opts.alignX=='left'||this.opts.alignY=='center')a.arrow='right'}switch(this.opts.alignY){case'bottom':case'inner-top':a.t=yB+this.opts.offsetY;if(!a.arrow||this.opts.alignTo=='cursor')a.arrow='top';if(this.opts.keepInViewport&&a.t+this.tipOuterH>win.t+win.h){a.t=yT-this.tipOuterH-this.opts.offsetY;if(a.arrow=='top')a.arrow='bottom'}break;case'center':a.t=yC-Math.floor(this.tipOuterH/2);if(this.opts.keepInViewport){if(a.t+this.tipOuterH>win.t+win.h)a.t=win.t+win.h-this.tipOuterH;else if(a.t<win.t)a.t=win.t}break;default:a.t=yT-this.tipOuterH-this.opts.offsetY;if(!a.arrow||this.opts.alignTo=='cursor')a.arrow='bottom';if(this.opts.keepInViewport&&a.t<win.t){a.t=yB+this.opts.offsetY;if(a.arrow=='bottom')a.arrow='top'}}this.pos=a}};$.fn.poshytip=function(b){if(typeof b=='string'){var c=arguments,method=b;Array.prototype.shift.call(c);if(method=='destroy'){this.die?this.die('mouseenter.poshytip').die('focus.poshytip'):$(document).undelegate(this.selector,'mouseenter.poshytip').undelegate(this.selector,'focus.poshytip')}return this.each(function(){var a=$(this).data('poshytip');if(a&&a[method])a[method].apply(a,c)})}var d=$.extend({},$.fn.poshytip.defaults,b);if(!$('#poshytip-css-'+d.className)[0])$(['<style id="poshytip-css-',d.className,'" type="text/css">','div.',d.className,'{visibility:hidden;position:absolute;top:0;left:0;}','div.',d.className,' table.tip-table, div.',d.className,' table.tip-table td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;vertical-align:middle;}','div.',d.className,' td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:',d.bgImageFrameSize,'px;width:',d.bgImageFrameSize,'px;overflow:hidden;}','div.',d.className,' td.tip-right{background-position:100% 0;}','div.',d.className,' td.tip-bottom{background-position:100% 100%;}','div.',d.className,' td.tip-left{background-position:0 100%;}','div.',d.className,' div.tip-inner{background-position:-',d.bgImageFrameSize,'px -',d.bgImageFrameSize,'px;}','div.',d.className,' div.tip-arrow{visibility:hidden;position:absolute;overflow:hidden;font:1px/1px sans-serif;}','</style>'].join('')).appendTo('head');if(d.liveEvents&&d.showOn!='none'){var e,deadOpts=$.extend({},d,{liveEvents:false});switch(d.showOn){case'hover':e=function(){var a=$(this);if(!a.data('poshytip'))a.poshytip(deadOpts).poshytip('mouseenter')};this.live?this.live('mouseenter.poshytip',e):$(document).delegate(this.selector,'mouseenter.poshytip',e);break;case'focus':e=function(){var a=$(this);if(!a.data('poshytip'))a.poshytip(deadOpts).poshytip('showDelayed')};this.live?this.live('focus.poshytip',e):$(document).delegate(this.selector,'focus.poshytip',e);break}return this}return this.each(function(){new $.Poshytip(this,d)})};$.fn.poshytip.defaults={content:'[title]',className:'tip-yellow',bgImageFrameSize:10,showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:'hover',liveEvents:false,alignTo:'cursor',alignX:'right',alignY:'top',offsetX:-22,offsetY:18,keepInViewport:true,allowTipHover:true,followCursor:false,fade:true,slide:true,slideOffset:8,showAniDuration:300,hideAniDuration:300,refreshAniDuration:200}})(jQuery);